<!doctype html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" />
		<title>Sole Insider</title>

		<link rel="stylesheet" href="assets/jquery/jquery.mobile-1.3.0-beta.1.min.css" />
			<link rel="stylesheet" href="assets/css/master.css" type="text/css" media="screen" />
	</head>
	<body>

<!-- Start of login div -->
<div data-role="page" id="loginPage" >

	<div data-role="header" data-theme="c">
		<a href="index.html" data-transition="slideup" rel="external" data-transition="slide">Back</a>
		<h1>Sole Insider</h1>

	</div><!-- /header -->

	 <div data-role="content" >

	<form id="loginAjaxForm">

		<h4> This app is best used over a wifi connection, but will work fine over a normal mobile data plan. </h4>

		<h3> Login </h3>
		<input type="text" class="username" value="">
		<input type="password" class="password" value="">
		<a href="#" id="loginBtn" data-role="button" data-theme=
		"b">Login</a>
		<a href="createaccount.html"  data-role="button" data-theme=
		"e">Create an account</a>
	</form>

	<hr/>
	</div> <!-- /content -->


</div>
<!-- /page -->

<script src="phonegap.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="assets/jquery/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="assets/jquery/jquery.mobile-1.3.0-beta.1.min.js" charset="utf-8"></script>
<script type="text/javascript" src="assets/js/config.js" charset="utf-8"></script>
<script>

$("#loginBtn").click(function(e){
        e.preventDefault();
        login();
        return false;
 });


function activeSession(){
		var username = localStorage.getItem("username");

		if (username !=""){
				window.location.href="dashboard.html";
		}

}

function login(){

	var data = {
		'username' : $(".username").val(),
		'password' : $(".password").val()
	};

	var formData = data;

    $.ajax({
        type: "POST",
        url: serviceURL+"login",
        cache: false,
        data: formData,
        success: function(data) {
		    data = $.trim(data);
			data = jQuery.parseJSON(data);

			if (data != false){
				localStorage.setItem('username', data.email);
				localStorage.setItem('member_id',  data.id);
				localStorage.setItem('member_type',  'member');
				window.location.href="dashboard.html";

			} else{
				alert("Incorrect login");
			}
		} // end success
    });
}

</script>
</body>
</html>